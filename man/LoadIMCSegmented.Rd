% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/LoadIMCSegmented.R
\name{LoadIMCSegmented}
\alias{LoadIMCSegmented}
\title{Build Seurat (v5) objects from MCDV IMC exports (per-FOV, no merge)}
\usage{
LoadIMCSegmented(
  top_dir,
  keep_unlabeled_channels = FALSE,
  assay = "IMC",
  make_sparse = TRUE,
  verbose = TRUE,
  add_asinh_layer = TRUE,
  asinh_cofactor = 5,
  put_matrix_in_data_layer = FALSE,
  drop_na_features = TRUE,
  drop_zero_var_features = TRUE,
  feature_name_fun = NULL,
  min_cells = 0,
  min_features = 0,
  spatial_rotate_k = 0L,
  build_segmentation_from_mask = TRUE,
  seg_simplify_tol = 2,
  default_boundary = c("centroids", "segmentation"),
  centroid_nsides = 6,
  save_h5seurat = NULL
)
}
\arguments{
\item{top_dir}{Character. Path to the MCDV workspace (e.g., \code{"Workspace_008"}).}

\item{keep_unlabeled_channels}{Logical. Keep channels without "_" in their name
(default \code{FALSE} drops unlabeled channels).}

\item{assay}{Character. Assay name to create (default \code{"IMC"}).}

\item{make_sparse}{Logical. Store expression as a sparse matrix when possible (default \code{TRUE}).}

\item{verbose}{Logical. Emit progress messages (default \code{TRUE}).}

\item{add_asinh_layer}{Logical. Add an \code{asinh} layer derived from \code{counts} (default \code{TRUE}).}

\item{asinh_cofactor}{Numeric. Cofactor for \code{asinh} (default \code{5}).}

\item{put_matrix_in_data_layer}{Logical. Also copy the input matrix to a Seurat \code{data} layer (default \code{FALSE}).}

\item{drop_na_features}{Logical. Drop features containing any NA (default \code{TRUE}).}

\item{drop_zero_var_features}{Logical. Drop zero-variance features (default \code{TRUE}).}

\item{feature_name_fun}{Optional function applied to \strong{friendly} feature names (after channel mapping).}

\item{min_cells, min_features}{Passed through to \code{Seurat::CreateSeuratObject} (defaults 0, 0).}

\item{spatial_rotate_k}{Integer in \{0,1,2,3\}. Rotate by 90°k around the FOV center (default \code{0}).}

\item{build_segmentation_from_mask}{Logical. Rebuild polygons from \code{Cell_mask.tiff} if it looks like a label map (default \code{TRUE}).}

\item{seg_simplify_tol}{Numeric. dTolerance (pixels) for polygon simplification (default \code{2}).}

\item{default_boundary}{One of \code{"centroids"} or \code{"segmentation"}; which to set as active on the FOV (default \code{"centroids"}).}

\item{centroid_nsides}{Numeric. Number of sides for centroid glyphs (default \code{6}; use \code{Inf} for circles).}

\item{save_h5seurat}{Optional file path template; if non-NULL, save each object as H5Seurat
using \code{SeuratDisk}, with \code{\{FOV\}} substituted by the FOV name (e.g., \code{"~/out/\{FOV\}.h5seurat"}).}
}
\value{
A named \code{list} of Seurat objects (one per FOV). Each object contains:
\itemize{
\item an \code{IMC} assay with \code{counts} (and optional \code{asinh}, \code{data})
\item a \code{spatial} reduction (\code{SP_1}, \code{SP_2}) rotated by 90°×k
\item a \code{FOV} with a \code{centroids} boundary; optional \code{segmentation}
\item tool data accessible via \code{SeuratObject::Tool(obj)}
(entry keyed to this function) containing \code{paths}, \code{feature_meta},
\code{scale_factors}, \code{spatial_orientation}, \code{transforms}, \code{provenance},
and optional \code{segmentation_coords}.
}
}
\description{
Ingest a top-level MCDV workspace and build \strong{one Seurat v5 object per FOV}.
The function minimizes redundancy (counts as the default layer, optional \code{asinh}),
attaches spatial information, and (optionally) reconstructs segmentation polygons
from the label mask, aligned to the centroid coordinate frame.
}
\section{Layers & normalization}{

The loader creates a \code{counts} layer and can derive an \code{asinh} layer (cofactor configurable).
}

\section{Feature hygiene}{

Logical options for dropping NA and/or 0 variance features, applying user specified naming conditions, and setting minimum cells or features required.
}

\section{Orientation}{

Optional rotation of image to designate tissue orientation alignment.
}

\section{Segmentation (optional)}{

Segmentation parameters.
}

\section{Output & provenance}{

Output options for saving generated objects.
}

\examples{
\dontrun{
objs <- load_segmented_IMC(
  top_dir = "~/inst/extdata/Workspace_008",
  keep_unlabeled_channels = FALSE,
  add_asinh_layer = TRUE,
  spatial_rotate_k = 1L,  # rotate 90 degrees
  build_segmentation_from_mask = TRUE,
  default_boundary = "segmentation"
)

first <- objs[[1]]
DefaultAssay(first)
SeuratObject::Images(first)
ImageDimPlot(first, fov = SeuratObject::DefaultFOV(first), boundaries = "segmentation")
}

}
\references{
Giesen C et al. (2014). Highly multiplexed imaging of tumor tissues with subcellular resolution by mass cytometry. Cell 159(7):1660–1675. doi:10.1016/j.cell.2014.11.023

Keren L et al. (2018). A structured tumor-immune microenvironment revealed by multiplexed ion beam imaging. Cell 174(6):1373–1387.e19. doi:10.1016/j.cell.2018.08.039

Le Rochais M et al. (2022). Application of High-Throughput Imaging Mass Cytometry Hyperion in Cancer Research. Front Immunol 13:859414. doi:10.3389/fimmu.2022.859414

Fluidigm Corporation (2019). MCD Viewer v1.0.560.6 User Guide (PN 400317-4, Rev. 3). https://www.imc.unibe.ch/unibe/portal/fak_medizin/micro_imc/content/e987276/e1000503/e1000513/MCDViewerv1.0.560.6UserGuide.pdf
}
\seealso{
\code{\link{IMCFovPlot}}
}
\author{
Meredith A. Carpenter
}
